<p align="center">
    <img
      src="https://www.gatsbyjs.com/Gatsby-Logo.svg"
      width="400"
      alt="Gatsby.js Logo"
    />
</p>


# Gatsby.js: Руководство разработчика

### Содержание

1. [Что такое Gatsby.js](#Что-такое-Gatsby.js)
  1. [Что такое SSG](#Что-такое-SSG)
  2. [Какую проблему решает Gatsby](#Какую-проблему-решает-Gatsby)
2. [Настройка окружения](#Настройка-окружения)
  1. [Gatsby CLI](#Gatsby-CLI)
    1. [Базовые команды](#Базовые-команды)
    2. [Создание сайта и Gatsby Starters](#Создание-сайта-и-Gatsby-Starters)
  2. [Шпаргалка по основным командам Gatsby](#Шпаргалка-по-основным-командам-Gatsby)
  3. [Настройка GitHub репозитория для Gatsby сайта](#Настройка-GitHub-репозитория-для-Gatsby-сайта)
3. [Структура Gatsby сайта](#Структура-Gatsby-сайта)
  1. [Папки](#Папки)
  2. [Файлы](#Файлы)
4. [Создание страниц в Gatsby](#Создание-страниц-в-Gatsby)
5. [Ссылки на страницы. Компонент &lt;Link&gt;](#Ссылки-на-страницы.-Компонент-&lt;Link&gt;)


## Что такое Gatsby.js

Gatsby [появился](https://www.gatsbyjs.com/blog/gatsby-v1/) в 2017 году изначально как невероятно быстрый генератор статических сайтов на React.

_Gatsby_ – генератор статических сайтов с открытым исходным кодом, созданный поверх Node.js в основе которого лежит библиотека React в сочетании с GraphQL, Webpack и другими инструментами. В качестве источника данных может использовать Markdown-документы, MDX (Markdown с JSX), картинки и разные CMS, такие, как WordPress, Drupal, Sanity, Strapi, Shopify и др.

Gatsby также позволяет комбинировать данные из разных источников и отображать их вместе друг с другом, например на одной странице данные блога могут подтягиваться из CMS WordPress, а eCommerce составляющая из Shopify и Stripe.

Gatsby позволяет достаточно быстро генерировать страницы сайта, который в свою очередь представляется безопасным перед базовыми уязвимостями, масштабируемым перед резким возрастанием трафика и SEO-оптимизированным.

![The modern website landscape](https://www.gatsbyjs.com/_gatsby/image/d49511ec78e1558d287d9369f7e461d2/bf75211527615cb5847a1d5aa03a6f66/content-mesh-1.avif?eu=d22ac827db1a1edd7385f5f44649c8d2cef9ddacb17858ff1608df3d3c2522cb44edd51f16291701912ba464dbb9a0db5ceff4897ead7904fb8a8773ce6bdcd481dd0a265246c1838d8f3e852a8ce2588320e2e16af5707c1a82cd58906c666c47614b2fa481eea978687beab7f4d3ab8daa777a5d777c25c733449ad05d979867e50129907d5b2615fb2f3da260db78669ec6318a68323741d33993c3bfdbe8df4a01ef91c18860c9f2b23b6750b436ba&a=w%3D600%26h%3D367%26fm%3Davif%26q%3D75&cd=94a25c4bfa99c261ce604dbca49d3aaf)

На сегодня Gatsby это полноценный _open source_ фреймворк, поставляющий «из коробки» большое количество возможностей. Помимо этого Gatsby предоставляет более 3 000 плагинов расширяющие его функциональность.

### Что такое SSG

_SSG (Static Site Generator)_ – программный инструмент позволяющий создавать статичные HTML-документы из записей различных источников, будь то текстовые записи или из данных различных CMS. В отличие от традиционных платформ динамических веб-сайтов предоставляет множество преимуществ:

* лучшая производительность;
* более высокий уровень безопасности;
* сравнительно низкая стоимость масштабирования;
* удобство обслуживания.

### Какую проблему решает Gatsby

При разработке сайта среди прочих факторов учитывается 3 важных аспекта, которые должны быть соблюдены:

- Поисковая оптимизация (SEO);
- Скорость загрузки сайта;
- Простота обновления элементов интерфейса сайта.

При _обычном статическом сайте_ с множеством страниц решается проблема только с поисковой оптимизацией (SEO) сайта, но никак с его скоростью и возможностью быстро обновить дизайн интерфейса, это придётся сделать многократно на множестве однотипных страниц.

_Одностраничные приложения_ быстро загружаются и легко изменяют вид интерфейса, но закономерно проигрывают в плане SEO-оптимизации, т.к. все изменения происходят на одной странице.

_Server Side Rendering (SSR)_ сайты производят рендер страниц на сервере после каждого запроса по заранее заданному шаблону. Подход решает проблему SEO и в такой сайт легко вносить изменения, но теряется время на обработку каждого запроса на сервере.

_Static Site Generator (SSG)_ сайты на Gatsby закрывают все 3 аспекта, т.к. пользователю отдаются полностью отрендеренные страницы со всеми данными, которые были сформированы на моменте сборки сайта. Это быстро и легко обновляемо, т.к. статически сгенерированные сайты могут работать как одностраничные SPA-приложения. Однажды загруженные компоненты и ссылки страницы сохраняются в кэш, повторный доступ к которым осуществляется мгновенно.

Gatsby сочетает в себе генерацию статического сайта, отложенную генерацию статики и интеллектуальный рендеринг страниц с выборочной предварительной загрузки важного контента, даёт ощущение быстрого и высокопроизводительного сайта, что оказывает положительное влияние на показатели SEO и конверсии.

## Настройка окружения

### Gatsby CLI

_Gatsby CLI_ – утилита командной строки, устанавливается глобально и служит для запуска команд для разработки сайтов на Gatsby. Подробная [документация по Gatsby CLI](https://www.gatsbyjs.com/docs/reference/gatsby-cli) дана на официальной странице.

```console
npm install gatsby-cli -g
```

_Список доступных команд_

```console
gatsby --help
```

_Проверка текущей версии_

```console
gatsby --version
```

#### Базовые команды

* `gatsby develop` – запускает девелопмент-сборку сайта и сервер разработки для отслеживания вносимых изменений в режиме реального времени. Альтернативная команда `npm run develop`, если Gatsby CLI не был установлен глобально;
* `gatsby build` – запускает продакшн-сборку проекта и подготавливает сайт для развёртывания (deployment) в Сети;
* `gatsby serve` – предоставляет продакшн-сборку для тестирования сайта перед деплоем;
* `info` – информация о среде разработки и доступных обновлениях, используется в отчётах об ошибках;
* `clean` – очищает папку `public` и кэш в `.cache`.

После запуска команды `gatsby develop` запустится локальный сервер разработки, который будет доступен по адресу указанный в сообщении в командной строке.

> http://localhost:8000

Встроенная в браузер IDE _GraphiQL_ для просмотра и изучения данных и схем GraphQL.

> http://localhost:8000/___graphql

#### Создание сайта и Gatsby Starters

Для создания сайта используется команда `gatsby new`, запускающая интерактивную подсказку после заполнения которой, Gatsby использует ответы для автоматического создания нового сайта на Gatsby.

```console
gatsby new my-new-site
```

или

```console
npx gatsby new my-new-site
```

_Перейти в директорию созданного сайта_

```bash
cd my-new-site
```

Для более быстрого создания сайта и запуска разработки существуют заранее разработанные и поддерживаемые сообществом готовые шаблоны сайтов Gatsby, которые называются _стартерами_ (Gatsby Starters).

Установка сайта с клонированием стартера:

```console
gatsby new [ПАПКА_САЙТА] [ССЫЛКА_НА_GIT_РЕПОЗИТОРИЙ_СТАРТЕРА]
```

Например, создадим сайт в папке `blog` со стартером `gatsby-starter-hello-world`:

```console
gatsby new blog https://github.com/gatsbyjs/gatsby-starter-hello-world
```

Подробнее о том как использовать стартеры в документации [Gatsby Starters](https://www.gatsbyjs.com/docs/starters/). Весь список стартеров доступен на [странице библиотеки Gatsby стартеров](https://www.gatsbyjs.com/starters/).

### Шпаргалка по основным командам Gatsby

![Gatsby Cheat Sheet Page 1](https://www.gatsbyjs.com/cheat-sheet_page_1.png)
![Gatsby Cheat Sheet Page 2](https://www.gatsbyjs.com/cheat-sheet_page_2.png)

### Настройка GitHub репозитория для Gatsby сайта

Многие платформы работающие с Gatsby подгружают файлы сайта с публичных репозиториев кода. На примере GitHub пример подключения удалённого репозитория:

```console
git remote add origin https://github.com/GITHUB_USERNAME/REPO_NAME.git
git branch -M master
git push -u origin master
```

## Структура Gatsby сайта

Обычная структура страниц в Gatsby выглядит следующим образом.

```text
/
|-- /.cache
|-- /plugins
|-- /public
|-- /src
    |-- /api
    |-- /pages
    |-- /templates
    |-- html.js
|-- /static
|-- gatsby-config.js
|-- gatsby-node.js
|-- gatsby-ssr.js
|-- gatsby-browser.js
```

### Папки

* `/cache` – автоматически генерируемая папка содержащая внутренний кэш в Gatsby. Содержимое не предназначено для изменения и должно быть проигнорировано в `.gitignore`;
* `/plugins` – плагины конкретного проекта на Gatsby не опубликованные как `npm` пакеты;
* `/public` – файлы проекта собранные в результате сборки, игнорируется в `gitigonre`;
* `/src` – исходные файлы проекта.
  * `/api` – зарезервированная директория файлы `*.js` и `*.ts` которых, становятся функциями Gatsby с путями основанными на имени файлов;
  * `/pages` – страницы Gatsby сайта с путями основанными на имени файлов;
  * `/templates` – шаблоны для формирования будущих страниц;
  * `html.js` – пользовательская конфигурация файла по умолчанию `.cache/default_html.js`.
* `/static` – папка для статических файлов не требующие обработки Webpack. Файлы этой папки будут скопированы в `/public` без изменений.

### Файлы

* `gatsby-browser.js` – файл описывающий использование браузерного API Gatsby (Gatsby Browser APIs) для реагирования на события в браузере;
* `gatsby-config.js` – основной файл конфигурации Gatsby. Содержит основную информацию о сайте, его метаданные, например название и описание сайта, используемые плагины и пр.;
* `gatsby-node.js` – файл описывающий использование Gatsby Node API. Код в этом файле запускается единожды при сборке сайта и позволяет динамически добавлять данные или реагировать на события во время жизненного цикла сборки сайта;
* `gatsby-ssr.js` – файл описывающий использование Gatsby Server Rendering API, позволяющий настраивать параметры и изменять содержимое статических HTML-файлов при их обработке на стороне сервера (SSR).

Поскольку сайты Gatsby также являются приложениями React, обычно используются стандартные шаблоны организации кода React, где внутри папки `/src` находятся папки типа `/components` и `/utils`.

## Создание страниц в Gatsby

Поскольку Gatsby в основе своей использует React, то элементы интерфейса и сами страницы создаются с помощью React компонентов.

_React компонент_ – это JavaScript-функция, возвращающая элемент React. Сам же _React элемент_ – это объект, который React использует для рендеринга DOM элементов.

Есть два основных типов компонентов используемые в сайтах на Gatsby:

_Компонент интерфейса_ представляет собой реализацию определённого блока в интерфейсе страницы, который может быть использован многократно.

_Компонент страницы_ содержит все элементы пользовательского интерфейса для определённой страницы сайта.

**Главная страница**

Создадим главный индексный файл `/src/pages/index.js`:

```js
// Шаг 1: Импорт библиотеки React
import React from 'react'

// Шаг 2: Определение компонента страницы
const IndexPage = () => {
  return (
    <main>
      <h1>Привет, мир!</h1>
      <p>Добро пожаловать в мой первый сайт на Gatsby!</p>
    </main>
  )
}

// Step 3: Экспорт компонента страницы
export default IndexPage
```

**Страница «Обо мне»**

Создадим ещё одну страницу «О нас» `src/pages/about.js`:

```js
import React from 'react'

const AboutPage = () => {
  return (
    <main>
      <h1>Обо мне</h1>
      <p>Всем привет! Я создатель данного сайта на Gatsby.</p>
    </main>
  )
}

export default AboutPage
```

Страницы, созданные в папке `src/pages`, используют имя файла в качестве маршрута для страницы. Например, если в папке есть файл с названием `src/pages/about.js`, то путь к этой странице будет по адресу `localhost:8000/about`.

## Ссылки на страницы. Компонент &lt;Link&gt;

Gatsby предоставляет встроенный компонент `<Link>` для внутренних ссылок. В отличие от тега `<a>` данный компонент добавляет функционал производительности, предварительно подгружая ресурсы страницы при прокрутке ссылки или при наведении на нее указателя мыши. Это позволяет быстрее загружать страницы, когда пользователь переходит по ссылке.

Импортируйте компонент `<link>` из пакета Gatsby:

```js
import { Link } from 'gatsby'
```

Путь ссылки указывается в ~~атрибуте~~ свойстве `to=""`

```js
<Link to="/about">Обо мне</Link>
```

Для внешних ссылок, используйте обычный HTML-тег `<a>`.

## Страница 404

Gatsby автоматически создает страницы из файлов каталога `src/pages`, но если пользователь переходит по несуществующему адресу, Gatsby вместо этого будет использовать компонент страницы `src/pages/404.js` для отображения ошибки.
